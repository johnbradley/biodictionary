<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="definition-edit">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <firebase-document
      id="firedoc"
          location=""
          data="{{definition}}"></firebase-document>
      <h2>Edit Definition</h2>
      <paper-input label="Term" value="{{term}}"></paper-input>
      <paper-input label="Text" value="{{text}}"></paper-input>
      <paper-button on-tap="_save_term" disabled="{{!cansave}}" raised>Save</paper-button>
      <paper-button on-tap="_delete_item" raised>Delete</paper-button>
  </template>

  <script>
    (function () {
      'use strict';

      Polymer({
        is: 'definition-edit',
        properties: {
          term: {
            type: String,
            notify: true,
            observer: '_value_changed',
          },
          text: {
            type: String,
            notify: true,
            observer: '_value_changed',
          },
          cansave: {
            type: Boolean,
            value: false,
          }, key: {
            type: String,
            observer: '_key_changed',
          }
        },
        ready: function() {
            console.log(app.params);
        },
        _key_changed: function() {
          var ref = new Firebase('https://biodictionary.firebaseio.com/definitions/' + this.key);
          var defedit = this;
          ref.on("value", function(snapshot) {
            defedit.term = snapshot.val().term;
            defedit.text = snapshot.val().text;
          }, function (errorObject) {

          });
        },
        _value_changed: function() {
          this.cansave = this._can_save();
        },
        _can_save: function() {
          return this.text && this.term;
        },
        _delete_item: function() {
          if (this.key) {
            var def = new Firebase('https://biodictionary.firebaseio.com/definitions/' + this.key);
            def.remove();
          }
          page('/');
        },
        _save_term: function() {
          if( this._can_save()) {
            if (this.key) {
              var def = new Firebase('https://biodictionary.firebaseio.com/definitions/' + this.key);
              def.update({ 'term': this.term, 'text': this.text});
            } else {
              var definitions = new Firebase('https://biodictionary.firebaseio.com/definitions');
              var fb = definitions.push({ 'term': this.term, 'text': this.text});
              this.key = fb.key();
            }
            page('/');
          }
        }
      });
    })();
  </script>

</dom-module>
