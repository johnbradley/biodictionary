<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="definition-edit">
  <template>
    <style>
      :host {
        display: block;
        padding: 20px;
      }
      .mainframe {
        max-width: 1024px;
        margin: 0 auto;
        width: 100%;
      }
    </style>
    <firebase-document
      id="firedoc"
          location=""
          data="{{definition}}"></firebase-document>
      <div class="mainframe">
        <h2>Edit Definition</h2>
        <paper-input label="Term" value="{{term}}"></paper-input>
        <paper-input label="Text" value="{{text}}"></paper-input>
        <paper-button on-tap="_saveTerm" disabled="{{!cansave}}" raised>Save</paper-button>
        <paper-button on-tap="_deleteItem" raised>Delete</paper-button>
      </div>
  </template>

  <script>
    (function () {
      'use strict';

      Polymer({
        is: 'definition-edit',
        properties: {
          term: {
            type: String,
            notify: true,
            observer: '_valueChanged',
          },
          text: {
            type: String,
            notify: true,
            observer: '_valueChanged',
          },
          cansave: {
            type: Boolean,
            value: false,
          }, key: {
            type: String,
            observer: '_keyChanged',
          }
        },
        _keyChanged: function() {
          if (!this.key) {
            this.term = '';
            this.text = ''  ;
          } else {
            var ref = new Firebase('https://biodictionary.firebaseio.com/definitions/' + this.key);
            var defedit = this;
            ref.on('value', function(snapshot) {
              defedit.term = snapshot.val().term;
              defedit.text = snapshot.val().text;
            }, function (errorObject) {
              console.log(errorObject);
            });
          }
        },
        _valueChanged: function() {
          this.cansave = this._canSave();
        },
        _canSave: function() {
          return this.text && this.term;
        },
        _deleteItem: function() {
          if (this.key) {
            var def = new Firebase('https://biodictionary.firebaseio.com/definitions/' + this.key);
            def.remove();
          }
          page('/');
        },
        _saveTerm: function() {
          if( this._canSave()) {
            if (this.key) {
              var def = new Firebase('https://biodictionary.firebaseio.com/definitions/' + this.key);
              def.update({ 'term': this.term, 'text': this.text});
            } else {
              var definitions = new Firebase('https://biodictionary.firebaseio.com/definitions');
              var fb = definitions.push({ 'term': this.term, 'text': this.text});
              this.key = fb.key();
            }
            page('/');
          }
        }
      });
    })();
  </script>

</dom-module>
